## 4. 右值引用与移动语义

首先给出一个参考链接，个人觉得是介绍右值引用，移动语义，移动构造函数和移动赋值运算符比较好的文章：https://www.jianshu.com/p/d19fc8447eaa 。

### 1. 左值与右值的基本概念

cpp中所有的值都必须是左值或者右值其中之一。cpp中对**左值**和**右值**的定义是：

+ **深层含义上的定义：**一个表达式中的左值是表达式结束后仍然存在的持久对象，右值是在表达式结束后就被销毁的临时变量或者是字面值。**
+ **语法上的定义：**可以进行取地址操作的具名值是左值，无法进行取地址操作的无名值是右值。**

例如：

```
int a=2;       // a是左值，表达式结束后仍然存在；2是右值，在表达式结束后就不复存在
int c=rand();  // c是左值，表达式结束后仍然存在；rand()作为函数的返回值，是右值，在表达式结束后就不存在
Element e=Element();  // e是右值，表达式结束后仍然存在；Element()是一个临时对象，是右值，在表达式结束后就不复存在
```

在cpp11中则对右值继续进行了细分，将右值细分为**临时值**和**字面值**，例如2, "abc"是字面值，而函数返回值，临时对象都属于临时值。但是在实际生产环境中，不必过于细分，统一称为右值即可。

### 2. 左值引用与右值引用

在cpp98/03中引入了左值引用，左值引用是给左值（变量）取的别名，但是不存在右值引用。直到cpp11才引入了右值引用，可以为右值取名。

在cpp11中使用&表示左值引用，使用&&表示右值引用，例如：

```
int a=0;    // a是左值，0是右值
int &b=a;   // b是左值引用
int &&c=0;  // c是右值引用
```

右值引用的主要作用是：

+ 持久化右值：对右值创建右值引用后，右值得到了一个新的别名从而被持久化，其生命期被延长到与右值引用相同。右值引用可以当作左值使用，从而可以避免开销巨大的拷贝操作。

下面的这个例子非常经典，可以用来理解右值引用的主要作用。

```
int a=rand();   // rand()的返回值是临时值，通过将临时值拷贝给a得到了函数返回值
int &&b=rand(); // rand()的返回值是临时值，通过右值引用使得临时值持久化，过程中不涉及到任何拷贝操作
function(Element());  // Element()创建了一个临时值，调用function时会拷贝该临时对象到函数形参变量上
Element &&c=Element();// 为Element()这个临时值创建了一个右值引用c，右值引用本身可以当作左值使用进行传参，整个过程中只创建了Element()一个临时变量，没有任何拷贝操作
function(c);          
```

### 3. 类的移动构造函数和移动赋值运算符


### 4. 左值转换为右值——std::move
